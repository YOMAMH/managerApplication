app.controller("businessCheck",["$scope","$http",function(e,n){function t(t,a,s){c(0),t&&"全部状态"!=t||(t="allType"),a||(a=0),s||(s="type"),$(".cover").css("display","block"),n.get("/admin/business/info",{params:{parm:t,query:a,type:s}}).success(function(n){e.BusIn=n.result,$(".cover").css("display","none"),c(1)}).error(function(){console.log(new Error("信息获取失败")),$(".cover").css("display","none")})}function a(e,t){e||(e="allType"),n.get("/admin/business/infoCount",{params:{type:e,content:t}}).success(function(e){s(e.count)}).error(function(){console.log(new Error("信息获取失败"))})}function s(e){$(".M-box3").pagination({totalData:e,showData:5,jump:!0,coping:!0,prevContent:"上页",nextContent:"下页"});var n=0;$(".M-box3").delegate("a","click",function(){switch($(this).html()){case"下页":o(++n,0);break;case"上页":o(--n,1);break;case"跳转":n=$(".M-box3").find("span.active").html()-1,o(n,2);break;default:n=parseInt($(this).html())-1,o(n,2)}})}function c(n){0==n?setTimeout(function(){for(var e=0;e<$(".btn-danger.check").length;e++)$(".btn-danger.check").eq(e).addClass("Btndisabled").attr("disabled",!0).html("已审批"),$(".btn-danger.check").eq(e).parent().prev().find("p").eq(0).css("color","black")}):setTimeout(function(){for(var n=0;n<$(".btn-danger.check").length;n++)$(".btn-danger.check").eq(n).addClass("Btndisabled").attr("disabled",!0).html("已审批"),e.BusIn[n]&&("未审批"==e.BusIn[n].type?$(".btn-danger.check").eq(n).removeClass("Btndisabled").attr("disabled",!1).html("未审批"):"已通过"==e.BusIn[n].type?$(".btn-danger.check").eq(n).parent().prev().find("p").eq(0).css("color","green"):"未通过"==e.BusIn[n].type&&$(".btn-danger.check").eq(n).parent().prev().find("p").eq(0).css("color","red"))})}function o(n,a){var s=e.current_option.key,c=$(".input-group >.form-control").val();0==a?c?t(c,n,"name"):t(s,n,c):1==a?c?t(c,n,"name"):t(s,n,c):c?t(c,n,"name"):t(s,n,c)}e.BUsInfo=!0,e.BUsInfo1=!1,e.BUsInfo2=!1,e.checkIndex=0,e.recordIndex=function(){e.checkIndex=this.$index},e.MRShowInfo=function(){var n=$.trim($(".btn-danger.check").eq(this.$index).html()),t=$(".typeTack").eq(this.$index).html();"未审批"==n?"再次提交"==t?$("#checkBtn1").removeClass("Btndisabled").attr("disabled",!1).html("未审批"):$("#checkBtn2").removeClass("Btndisabled").attr("disabled",!1).html("未审批"):"再次提交"==t?$("#checkBtn1").addClass("Btndisabled").attr("disabled",!0).html("已审批"):$("#checkBtn2").addClass("Btndisabled").attr("disabled",!0).html("已审批"),e.BusInform={name:$(angular.element(".btn-default.showBusInfoBtn")[this.$index]).parent().parent().children()[1].innerHTML,time:$(angular.element(".btn-default.showBusInfoBtn")[this.$index]).parent().parent().children()[2].innerHTML},$(angular.element(".cover")).css("display","block"),t&&"再次提交"==t?(e.BUsInfo=!1,e.BUsInfo1=!0,e.BUsInfo2=!1):(e.BUsInfo=!1,e.BUsInfo1=!1,e.BUsInfo2=!0),setTimeout(function(){$(angular.element(".cover")).css("display","none")},1e3)},e.back=function(){e.BUsInfo=!0,e.BUsInfo1=!1,e.BUsInfo2=!1},t(),e.download=function(){location.href="/get/download/"},e.refuse=function(){e.publicFun(".btn-danger.check"),$(angular.element(".btn-danger.check").eq(e.checkIndex).parents().eq(0).siblings()[3]).html("未通过").css("color","red");var t=$(angular.element(".btn-danger.check").eq(e.checkIndex).parents().eq(0).siblings()[1]).html(),a=$(angular.element(".btn-danger.check").eq(e.checkIndex).parents().eq(0).siblings()[3]).html(),s=$(angular.element("#msg1 textarea")).val();n.post("/admin/business/update",{name:t,type:a,info:0,msg:s}).success(function(e){}).error(function(){console.log(new Error("信息更新失败"))})},e.permit=function(){e.publicFun(".btn-danger.check"),$(angular.element(".btn-danger.check").eq(e.checkIndex).parents().eq(0).siblings()[3]).html("已通过").css("color","green");var t=$(angular.element(".btn-danger.check").eq(e.checkIndex).parents().eq(0).siblings()[1]).html(),a=$(angular.element(".btn-danger.check").eq(e.checkIndex).parents().eq(0).siblings()[3]).html();$(angular.element("#msg1 textarea")).val();n.post("/admin/business/update",{name:t,type:a,info:1,msg:"pass"}).success(function(e){}).error(function(){console.log(new Error("信息更新失败"))})},e.infoRefuse=function(){e.publicFun("#checkBtn")},e.infoPermit=function(){e.publicFun("#checkBtn")},e.change=function(e){"全部状态"!=e.key?(t(e.key),a("type",e.key)):(t(),a())},e.option_array=[{key:"全部状态",value:0},{key:"未审批",value:1},{key:"未通过",value:2},{key:"已通过",value:3}],e.current_option=e.option_array[0],$(angular.element("img")).on("mousedown",function(){$(this).addClass("showBigImgBtnS")}).on("mouseleave",function(){$(this).removeClass("showBigImgBtnS")}),e.searchInfo=function(){var e=$(".input-group >.form-control").val();t(e,0,"name"),a("name",e)},e.publicFun=function(n){$(angular.element(n)[e.checkIndex]).addClass("Btndisabled").attr("disabled",!0).html("已审批")},a()}]);