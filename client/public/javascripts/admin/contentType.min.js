app.controller("contentType",["$scope","$http",function(n,t){function e(n,e,a){t.get("/admin/content/checkOneClass",{params:{oneClass:n,oneSortId:e}}).success(function(n){a(n)}).error(function(){console.log(new Error("信息获取失败"))})}function a(n){$(".M-box3").pagination({totalData:n,showData:1,jump:!0,coping:!0,prevContent:"上页",nextContent:"下页"});var t=0;$(".M-box3").delegate("a","click",function(){switch($(this).html()){case"下页":s(++t);break;case"上页":s(--t);break;case"跳转":t=$(".M-box3").find("span.active").html()-1,s(t);break;default:t=parseInt($(this).html())-1,s(t)}})}function s(e){e||(e=0),$(".cover").css("display","block"),t.get("/admin/content/totalClass",{params:{index:e}}).success(function(t){n.classItems=t.result,$(".cover").css("display","none")}).error(function(){console.log(new Error("信息获取失败"))})}function r(){var n={},e="";!function(arguments){var t=0;for(t;t<arguments.length;t++)n[t]=arguments[t];return n}(arguments),t.post("/admin/content/upDataClass",{oneClass:n[0],twoClass:n[1],threeClass:n[2],oneSortId:n[3],twoSortId:n[4],threeSortId:n[5]}).success(function(t){t.result.info&&n[6]&&(e=n[6])()}).error(function(){alert("添加失败")})}function i(n){var e=[];"string"==typeof n?e.push(n):!function(){var t=0;for(t;t<n.length;t++)e.push(n[t]);return e}(),t.post("/admin/content/addSortId",{number:e}).success(function(n){}).error(function(){console.error("数据插入失败")})}function p(){var n={},e=arguments;!function(){var t=0;for(t;t<e.length;t++)n[t]=e[t];return n}(),t.post("/admin/content/updateCategory",{oneClass:n[0],twoClass:n[1],threeClass:n[2],type:n[3],category:n[4],originallyName:n[5]}).success(function(){}).error(function(){alert("操作失败")})}function o(n,t,e,a,s,r,i){if($(n).parent().parent().hasClass("typeContentThree")){if($(n).parent().parent().parent().find(".typeContentItem").children().last().find("a").first().html()==a&&$("#typeConent").find(".col-xs-2").find("a").eq(0).html()==a){$(n).html(s),"启用"==s?$(n).parent().find("a").css("color","#A9A9A9"):$(n).parent().find("a").css("color","#337ab7"),$(n).parent().parent().css("backgroundColor",t).css("color",e);var o=$(n).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),l=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html(),c=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-5").find("span"),d=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2").find("span"),f=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2").find("a:eq(0)"),h=$(n).parent().parent().find(".col-xs-5").find("span").html(),u=[];!function(){var n=0;for(n;n<c.length;n++){var t="",e=$(c).eq(n).html(),a=$(d).eq(n).html();t=$(c).eq(n).html()==h||$(f).eq(n).html()==s?r:i,u.push({name:e,sortId:a,type:t})}return u}(),p(o,l,u,r,3)}}else if($(n).parent().parent().hasClass("typeContentItem")){if("禁用"==$("#typeConent").find(".col-xs-2").find("a").eq(0).html()){$(n).html(s),"启用"==s?$(n).parent().find("a").css("color","#A9A9A9"):$(n).parent().find("a").css("color","#337ab7"),$(n).parent().parent().css("backgroundColor",t).css("color",e);var m=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2:eq(1)").find("a:eq(0)");"启用"==s?($(n).parent().find("a").css("color","#A9A9A9"),function(){var n=0;for(n;n<m.length;n++)$(m).eq(n).parent().parent().css("backgroundColor",t).css("color",e),$(m).eq(n).parent().find("a").css("color","#A9A9A9")}()):($(n).parent().find("a").css("color","#337ab7"),function(){var n=0;for(n;n<m.length;n++)"禁用"==$(m).eq(n).html()&&($(m).eq(n).parent().parent().css("backgroundColor",t).css("color",e),$(m).eq(n).parent().find("a").css("color","#337ab7"))}());var o=$(n).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),l=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html();p(o,l,"",r,2)}}else{var m=$(n).parent().parent().parent().find(".typeContentTwo").find(".typeContentItem").find(".col-xs-2:eq(1)").find("a:eq(0)");$(n).html(s),"启用"==s?($(n).parent().find("a").css("color",e),function(){var n=0;for(n;n<m.length;n++)"禁用"==$(m).eq(n).html()&&($(m).eq(n).parent().parent().parent().css("backgroundColor",t).css("color",e),$(m).eq(n).parent().parent().parent().find("a").css("color",e))}()):($(n).parent().find("a").css("color","#337ab7"),function(){var n=0;for(n;n<m.length;n++)if("禁用"==$(m).eq(n).html()){$(m).eq(n).parent().parent().parent().css("backgroundColor",t).css("color",e),$(m).eq(n).parent().parent().parent().find(".typeContentItem").find(".col-xs-2:eq(1)").find("a").css("color","#337ab7");var a=$(m).eq(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2:eq(1)").find("a");console.log(a),function(){var n=0;for(n;n<a.length;n++)"禁用"==$(a).eq(n).html()&&($(a).eq(n).parent().parent().parent().css("backgroundColor",t).css("color",e),$(a).eq(n).parent().find("a").css("color","#337ab7"))}()}}()),$(n).parent().parent().css("backgroundColor",t).css("color",e);var o=$(n).parent().parent().find(".col-xs-5").find("span").find("span").html();p(o,"","",r,1)}}function l(n){if($(n).parent().parent().hasClass("typeContentThree")){if("禁用"==$(n).parent().parent().parent().find(".typeContentItem").children().last().find("a").first().html()&&"禁用"==$("#typeConent").find(".col-xs-2").find("a").eq(0).html()&&"禁用"==$(n).parent().children().first().html()){$(n).html("保存");var t=$(n).parent().parent().find(".col-xs-5").find("span").html();m=t,$(n).parent().parent().find(".col-xs-5").html('<input type="text" class="threeClassIn"                   value="'+t+'">')}}else if($(n).parent().parent().hasClass("typeContentItem")){if("禁用"==$("#typeConent").find(".col-xs-2").find("a").eq(0).html()&&"禁用"==$(n).parent().children().first().html()){$(n).html("保存");var e=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html();m=e,$(n).parent().parent().find(".col-xs-5").find("span:eq(1)").remove(),$(n).parent().parent().find(".col-xs-5").append('<input type="text" class="oneClassIn" value="'+e+'">')}}else if("禁用"==$(n).parent().children().first().html()){$(n).html("保存");var a=$(n).parent().parent().find(".col-xs-5").find("span").find("span").html();m=a,$(n).parent().parent().find(".col-xs-5").find(".glyphicon").find("span").remove(),$(n).parent().parent().find(".col-xs-5").append('<input type="text" placeholder="添加一级分类" class="oneClassIn" value="'+a+'">')}}function c(n){if($(n).parent().parent().hasClass("typeContentThree")){var t=$(n).parent().parent().find(".col-xs-5").find("input").val();$(n).html("编辑"),$(n).parent().parent().find(".col-xs-5").html('<span class="oneClassTittle">'+t+"</span>");var e=$(n).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),a=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html(),s=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-5").find("span"),r=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2").find("span"),i=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2").find("a:eq(0)"),o=[];!function(){var n=0;for(n;n<s.length;n++){var t="",e=$(s).eq(n).html(),a=$(r).eq(n).html();t="启用"==$(i).eq(n).html()?"0":"1",o.push({name:e,sortId:a,type:t})}return o}(),t&&t!=m?p(e,a,o,"",3):$(n).parent().parent().find(".col-xs-5").find("span").html(m),m=""}else if($(n).parent().parent().hasClass("typeContentItem")){$(n).html("编辑");var e=$(n).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),a=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("input").val();$(n).parent().parent().find(".col-xs-5").find("input").remove(),$(n).parent().parent().find(".col-xs-5").append('<span class="oneClassTittle">'+a+"</span>"),a?p(e,a,"","",2,m):$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html(m),m=""}else{$(n).html("编辑");var e=$(n).parent().parent().find(".col-xs-5").find("input").val();$(n).parent().parent().find(".col-xs-5").find("input").remove(),$(n).parent().parent().find(".col-xs-5").find("span").append('<span class="oneClassTittle">'+e+"</span>"),e?p(e,"","","",1,m):$(n).parent().parent().find(".col-xs-5").find("span").find("span").html(m),m=""}}function d(n){if($(n).parent().parent().hasClass("typeContentThree")){if($(n).parent().parent().hasClass("typeContentThree")&&"禁用"==$(n).parent().parent().parent().find(".typeContentItem").children().last().find("a").first().html()&&"禁用"==$("#typeConent").find(".col-xs-2").find("a").eq(0).html()&&"禁用"==$(n).parent().children().first().html()){var t=$(n).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),e=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html();$(n).parent().parent().fadeOut(500),setTimeout(function(){m=$(n).parent().parent().find(".col-xs-5").find("span").html();var a=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-5").find("span"),s=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2").find("span"),r=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2").find("a:eq(0)"),i=$(n).parent().parent().find(".col-xs-2:eq(0)").find("span").html(),o=[];!function(){var n=0;for(n;n<a.length;n++){var t="",e=$(a).eq(n).html(),i=$(s).eq(n).html();m!=e&&(t="启用"==$(r).eq(n).html()?"0":"1",o.push({name:e,sortId:i,type:t}))}return o}(),p(t,e,o,"",3),h(i),$(n).parent().parent().remove(),m=""},500)}}else if($(n).parent().parent().hasClass("typeContentItem")){if("禁用"==$("#typeConent").find(".col-xs-2").find("a").eq(0).html()&&"禁用"==$(n).parent().children().first().html()){var t=$(n).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),e=$(n).parent().parent().parent().children().first().find(".col-xs-5").find("span:eq(1)").html(),a=[],s=$(n).parent().parent().parent().children().first().find(".col-xs-2:eq(0)").find("span").html(),r=$(n).parent().parent().parent().find(".typeContentThree").find(".col-xs-2:eq(0)").find("span");!function(){var n=0;for(n;n<r.length;n++)a.push($(r).eq(n).html());return a.push(s),a}(),$(n).parent().parent().parent().fadeOut(500),setTimeout(function(){f(t,e,2,function(){h(a),$(n).parent().parent().parent().remove()})},500)}}else if("禁用"==$(n).html()){var t=$(n).parent().parent().find(".col-xs-5").find("span").find("span").html(),i=$(n).parent().parent().find(".col-xs-2:eq(0)").find("span").html(),o=$(n).parent().parent().parent().find(".typeContentTwo").find(".typeContentItem").find(".col-xs-2").find("span"),l=$(n).parent().parent().parent().find(".typeContentTwo").find(".typeContentThree").find(".col-xs-2").find("span"),c=[],d=[],u=[];u.push(i),function(){var n=0;for(n;n<o.length;n++)d.push($(o).eq(n).html()),u.push($(o).eq(n).html());return d}(),function(){var n=0;for(n;n<l.length;n++)c.push($(l).eq(n).html()),u.push($(l).eq(n).html());return c}(),$(n).parent().parent().parent().fadeOut(500),setTimeout(function(){h(u),f(t,"",1,function(){$(n).parent().parent().parent().remove()})},500)}}function f(n,e,a,s){t.post("/admin/content/deleteCategory",{oneClass:n,twoClass:e,type:a}).success(function(n){s&&s()}).error(function(){alert("删除失败")})}function h(n){var e=[];"string"==typeof n?e[0]=n:e=n,t.post("/admin/content/deleateSortId",{sortId:e}).success(function(){}).error(function(){alert("删除类目id失败")})}function u(){var n=parseInt(1e4*Math.random());return t.get("/admin/content/checkSortId",{params:{number:n}}).success(function(n){"object"==typeof n.result[0]&&u()}).error(function(){console.error("获取信息失败")}),n>1e3?n:u()}s(),$(".contentManage").delegate("input","click",function(n){switch(this.className){case"btn btn-success btnClassAdd btnClassAddTwo":if("保存"!=$(this).val())$(this).parent().parent().parent().append("<div class='typeContentTwo clearfix'><div class='typeContentItem clearfix'><div class='col-xs-5 col-sm-5 col-md-5 twoTitle'><span class='glyphicon glyphicon-menu-hamburger tag'></span><input type=\"text\"placeholder=\"添加二级分类\"class='twoClassIn'></div><div class='col-xs-2 col-sm-2 col-md-2'><span>"+u()+"</span></div><div class='col-xs-3 col-sm-3 col-md-3'><input type=\"button\"style=\"margin: 0 auto\" value=\"添加三级分类\"class='btn btn-success btnClassAdd btnClassAddThree'></div><div class='col-xs-2 col-sm-2 col-md-2'><a href='javascript:void(0);'>禁用</a><a href='javascript:void(0);'>编辑</a><a href='javascript:void(0);'>删除</a></div></div><div class='typeContentThree clearfix'><div class='col-xs-5 col-sm-5 col-md-5 threeTitle'><input type='text'placeholder='添加三级分类'class='threeClassIn'></div><div class='col-xs-2 col-sm-2 col-md-2'><span>"+u()+"</span></div><div class='col-xs-3 col-sm-3 col-md-3'></div><div class='col-xs-2 col-sm-2 col-md-2'><a href='javascript:void(0);'>禁用</a><a href='javascript:void(0);'>编辑</a><a href='javascript:void(0);'>删除</a></div></div></div>"),$(this).val("保存"),$(this).css("padding","0 65px 0 35px");else{$(this).val("添加二级分类"),$(this).css("padding","0 90px 0 10px");var e=0,a=1;for($(this).parent().parent().parent().find('.typeContentTwo:last input[type="text"]').length<1&&(a=2),e;e<$(this).parent().parent().parent().find('.typeContentTwo:last input[type="text"]').length;e++)$(this).parent().parent().parent().find('.typeContentTwo:last input[type="text"]').eq(e).val()||(a=0);if(0==a)$(this).parent().parent().parent().find(".typeContentTwo:last").remove();else if(1==a&&($(this).parent().parent().parent().find('.typeContentTwo:last input[type="text"]').attr("disabled",!0).css("color","#333").css("border","none"),$(this).parent().parent().find("div").eq(0).find("span").find("span").html())){var s=[],p=[],o=$(this).parent().parent().find("div").eq(0).find("span").find("span").html(),l=$(this).parent().parent().parent().children().last().children().first().children().first().find("input").val(),c=$(this).parent().parent().parent().children().last().children().first().children().eq(1).find("span").html(),d=$(this).parent().parent().parent().children().last().find(".typeContentThree").find(".col-xs-5.threeTitle").find("input"),f=$(this).parent().parent().parent().children().last().find(".typeContentThree").find(".col-xs-2").find("span");!function(){var n=0;for(n;n<d.length;n++)s.push($(d).eq(n).val());return s}(),function(){var n=0,t=[];for(t.push(c),n;n<f.length;n++)p.push($(f).eq(n).html()),t.push($(f).eq(n).html());return i(t),p}(),r(o,l,s,"",c,p,function(){"添加一级分类"==$("#addClassOne").html()&&window.location.reload(),alert("插入成功！")})}}break;case"btn btn-success btnClassAdd btnClassAddThree":if("保存"!=$(this).val())$(this).parent().parent().parent().append("<div class='typeContentThree clearfix'><div class='col-xs-5 col-sm-5 col-md-5 threeTitle'><input type='text'placeholder='添加三级分类'class='threeClassIn'></div><div class='col-xs-2 col-sm-2 col-md-2'><span>"+u()+"</span></div><div class='col-xs-3 col-sm-3 col-md-3'></div><div class='col-xs-2 col-sm-2 col-md-2'><a href='javascript:void(0);'>禁用</a><a href='javascript:void(0);'>编辑</a><a href='javascript:void(0);'>删除</a></div></div>"),$(this).val("保存"),$(this).css("padding","0 65px 0 35px");else{$(this).val("添加三级分类"),$(this).css("padding","0 90px 0 10px");var a=1;if($(this).parent().parent().parent().find('.typeContentThree:last input[type="text"]').val()||(a=0),0==$(this).parent().parent().parent().find('.typeContentThree:last input[type="text"]').length&&(a=2),0==a)$(this).parent().parent().parent().find(".typeContentThree:last").remove(),a=0;else if(1==a){$(this).parent().parent().parent().find('.typeContentThree:last input[type="text"]').attr("disabled",!0).css("color","#333").css("border","none");var o=$(this).parent().parent().parent().parent().children().first().find(".col-xs-5").find("span").find("span").html(),l=$(this).parent().parent().parent().children().first().find(".col-xs-5").find("span").eq(1).html(),h=$(this).parent().parent().parent().find(".typeContentThree:last").find(".col-xs-5").find("input").val(),m=$(this).parent().parent().parent().find(".typeContentThree:last").find(".col-xs-2").find("span").html();t.post("/admin/content/updateThreeClass",{oneClass:o,twoClass:l,threeClass:h,threeSortId:m}).success(function(n){n.result instanceof Object&&(i(m),"添加一级分类"==$("#addClassOne").html()&&window.location.reload(),alert("添加三级分类成功"))}).error(function(){alert("添加三级分类失败")})}}n.stopPropagation()}});var m="";$(".contentManage").delegate("a","click",function(){var n=$(this).html();"禁用"==n&&o(this,"#D3D3D3","#A9A9A9","禁用","启用","0","1"),"启用"==n&&o(this,"white","#333","禁用","禁用","1","0"),"编辑"==n&&l(this),"保存"==n&&c(this),"删除"==n&&d(this)}),$("#addClassOne").on("click",function(){function n(){var n=0;for(n;n<c.length;n++){var t=$(c).eq(n),e=$(c).eq(n).val(),a=$(d).eq(n).html(),s=$(t).parent().parent().parent().find(".typeContentThree"),i=0,p=[],f=[];for(i;i<s.length;i++)p.push($(s).eq(i).find(".col-xs-5").find("input").val()),f.push($(s).eq(i).find(".col-xs-2").find("span").html());r(o,e,p,l,a,f)}}if("添加一级分类"==$(this).html())$("#typeConent >.typeContentItem").append('<div class="typeContentOneAdd clearfix"><div class="clearfix"><div class="col-xs-5 col-sm-5 col-md-5"><span class="glyphicon glyphicon-menu-hamburger tag"></span><input type="text"placeholder="添加一级分类"class="oneClassIn"></div><div class="col-xs-2 col-sm-2 col-md-2"><span class="oneSort">'+u()+"</span></div><div class=\"col-xs-3 col-sm-3 col-md-3\"><input type=\"button\"style=\"margin: 0 auto\"value=\"添加二级分类\"class=\"btn btn-success btnClassAdd btnClassAddTwo\"></div><div class=\"col-xs-2 col-sm-2 col-md-2\"><a href='javascript:void(0);'>禁用</a><a href='javascript:void(0);'>编辑</a><a href='javascript:void(0);'>删除</a></div></div><div class='typeContentTwo clearfix'><div class='typeContentItem clearfix'><div class='col-xs-5 col-sm-5 col-md-5 twoTitle'><span class='glyphicon glyphicon-menu-hamburger tag'></span><input type=\"text\"placeholder=\"添加二级分类\"class='twoClassIn'></div><div class='col-xs-2 col-sm-2 col-md-2'><span class=\"twoSort\">"+u()+"</span></div><div class='col-xs-3 col-sm-3 col-md-3'><input type=\"button\"style=\"margin: 0 auto\" value=\"添加三级分类\"class='btn btn-success btnClassAdd btnClassAddThree'></div><div class='col-xs-2 col-sm-2 col-md-2'><a href='javascript:void(0);'>禁用</a><a href='javascript:void(0);'>编辑</a><a href='javascript:void(0);'>删除</a></div></div><div class='typeContentThree clearfix'><div class='col-xs-5 col-sm-5 col-md-5 threeTitle'><input type='text'placeholder='添加三级分类'class='threeClassIn'></div><div class='col-xs-2 col-sm-2 col-md-2'><span class=\"threeSort\">"+u()+"</span></div><div class='col-xs-3 col-sm-3 col-md-3'></div><div class='col-xs-2 col-sm-2 col-md-2'><a href='javascript:void(0);'>禁用</a><a href='javascript:void(0);'>编辑</a><a href='javascript:void(0);'>删除</a></div></div></div></div>"),$(this).html("保存");else{$(this).html("添加一级分类");var a=0,s=1,p=$(".typeContentItem").find('.typeContentOneAdd:last input[type="text"]');for(p.length<1&&(s=2),a;a<p.length;a++)p.eq(a).val()||(s=0);if(1==s){p.attr("disabled",!0).css("color","#333").css("border","none");var o=$("#typeConent .typeContentOneAdd").children().first().find(".col-xs-5").find("input").val(),l=$("#typeConent .typeContentOneAdd").children().first().find(".col-xs-2").find("span").html(),c=$("#typeConent .typeContentOneAdd").find(".typeContentTwo").find(".typeContentItem").find(".col-xs-5").find("input"),d=$("#typeConent .typeContentOneAdd").find(".typeContentTwo").find(".typeContentItem").find(".col-xs-2").find("span"),f=$("#typeConent .typeContentOneAdd").find(".typeContentTwo").find(".typeContentThree").find(".col-xs-2").find("span"),h=[],m=[],v=[];v.push(l),function(){var n=0;for(n;n<d.length;n++)m.push($(d).eq(n).html()),v.push($(d).eq(n).html());return m}(),function(){var n=0;for(n;n<f.length;n++)h.push($(f).eq(n).html()),v.push($(f).eq(n).html());return h}(),e(o,l,function(e){e.result[0]instanceof Object?(n(),alert("插入数据成功！")):t.post("/admin/content/createOneClass",{oneClass:o,oneSortId:l}).success(function(t){n(),setTimeout(function(){window.location.reload()},100),alert("插入数据成功！")}).error(function(){alert("创建一级类目失败")})}),i(v)}else $(".typeContentOneAdd:last").remove()}}),t.get("/admin/content/totalClassCount").success(function(n){a(n.result?n.result.count:1)}).error(function(){console.log(new Error("信息获取失败"))}),n.setClass=function(n){return"0"==n?"disableStyleOne":""},n.setText=function(n){return"0"==n?"启用":"禁用"}}]);